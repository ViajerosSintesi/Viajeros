function subirImgPerfil(){var e=$("#foto-perfil")[0].files[0];var t=e.name;var n=t.substring(t.lastIndexOf(".")+1);var r=e.size;var i=e.type;if(r<=2e5&&n=="jpeg"||n=="png"||n=="jpg"){var s=new FormData;s.append("imgPerfil",e);$.ajax({url:"php/controles/modificarPerfil.php",type:"POST",data:s,cache:false,contentType:false,processData:false,success:function(e){if(e==1){alertify.success("Subido perfectamente!");cargarDatos()}else alertify.error("no se ha subido")}})}else{alertify.error("La imagen es demasiado grande o no cumple el formato correcto")}}function isImage(e){switch(e.toLowerCase()){case"jpg":case"gif":case"png":case"jpeg":return true;break;default:return false;break}}function cargarDatos(){var e=$("#userIdForImg").val();var t={datosPerfil:1,userId:e};$.getJSON("php/controles/controlPerfil.php",t,function(e){$("#nombreUser").html(e.nombre);$("#apellidosUser").html(e.apellidos);$("#perfil-nombre").val(e.nombre);$("#perfil-apellidos").val(e.apellidos);$("#emailUser").html(e.email);$("#edadUser").html(e.edad);if(e.imgPerfil!=null)document.getElementById("img-Perfil").src=e.imgPerfil});var n={fotosForPerfil:1,userId:e};$.getJSON("php/controles/controlImagen.php",n,function(t){var n="";for(var r=0;r<t.length;r++){var i=t[r].ruta+"/"+t[r].nombre;n+='<img src="'+i+'" class="imagenDeCiudad" data-user="'+t[r]["usuario"]+'" name="'+t[r]["_id"]["$id"]+'">';n+='<div id="'+t[r]["_id"]["$id"]+'" class="dialogImg"> </div>'}$("#fotos").html(n);$(".imagenDeCiudad").click(function(){var t=$(this).attr("name");var n=0;if(e==$(this).attr("data-user"))n=1;imgDialog(e,t,n)})})}function modPerfil(){$("body").append("<div id='cargaAjax'> <img src='img/gif-load.gif'/></div>");var e=$("#perfil-nombre").val();var t=$("#perfil-apellidos").val();var n=$("#perfil-email").val();var r=$("#perfil-password").val();var i=$("#privacidad").val();var s={modPerfil:1,username:e,apellidos:t,email:n,password:r,privacidad:i};$.post("php/controles/modificarPerfil.php",s,function(e){var t=JSON.parse(e);if(t.notice)alertify.success("Datos modificados correctamente!");else alertify.error(":( Ha habido algun problema al actualizar los datos");cargarDatos();$("#info").show();$("#form-info").hide()})}function subirFotos(){var e=$("#picture")[0].files[0];var t=e.name;var n=t.substring(t.lastIndexOf(".")+1);var r=e.size;var i=e.type;var s=$("#userIdForImg").val();console.log(s);var o=$("#buscarForImg").val();if(r<=5e4&&n=="jpeg"||n=="png"||n=="jpg"){var u=new FormData;u.append("imgPerfil",e);u.append("userId",s);u.append("ciudadId",o);$.ajax({url:"php/controles/modificarPerfil.php",type:"POST",data:u,cache:false,contentType:false,processData:false,success:function(e){if(e==1)cargarDatos();else alertify.error("no se ha subido")}})}else{alertify.alert("La imagen es demasiado grande o no cumple el formato correcto")}}$(function(){cargarDatos();$("#form-info").hide();$("#perfil-edit").click(function(){$("#info").hide();$("#form-info").show()});$("#cancelar-datos").click(function(){$("#form-info").hide();$("#info").show()});$("#modificar-datos").click(modPerfil);$("#foto-perfil").change(subirImgPerfil);$("#buscarForImg").autocomplete({source:buscador});$("#formfotos").submit(subirFotos);$("#enviaMensaje").click(function(){alertify.prompt("Dejale un mensaje: ",function(e,t){if(e){var n=$("#userIdForImg").val();var r=(new Date).toString();var i={userReceptor:n,texto:t,fecha:r,enviarMnsj:1};$.getJSON("php/controles/controlMensajes.php",i,function(e){if(e)alertify.success("enviado correctamente");else alertify.error("No se ha podido enviar :(")})}})})})